// Generated by CoffeeScript 1.6.2
var child_process, cryptobox_ctrl, path;

child_process = require("child_process");

path = require("path");

angular.module("cryptoboxApp", ["cryptoboxApp.base"]);

cryptobox_ctrl = function($scope, $q, memory, utils) {
  var run_command,
    _this = this;

  memory.set("g_running", true);
  $scope.on_exit = function() {
    return console.log("cryptobox.cf:12", window.globals);
  };
  window.addEventListener("beforeunload", $scope.on_exit);
  run_command = function(cmd_name) {
    var child, cmd_to_run, p, process_result;

    if (memory.has("g_process_" + cmd_name)) {
      return;
    }
    console.log("cryptobox.cf:18", cmd_name);
    cmd_to_run = path.join(process.cwd(), "commands");
    cmd_to_run = path.join(cmd_to_run, cmd_name);
    p = $q.defer();
    process_result = function(error, stdout, stderr) {
      if (utils.exist(stderr)) {
        console.log("cryptobox.cf:25", stderr);
      }
      if (utils.exist(error)) {
        p.reject(error);
      } else {
        console.log("cryptobox.cf:29", "resolving");
        p.resolve(stdout);
      }
      memory.del("g_process_" + cmd_name, child);
      return utils.force_digest($scope);
    };
    child = child_process.exec(cmd_to_run, process_result);
    memory.set("g_process_" + cmd_name, child);
    return p.promise;
  };
  $scope.python_version = run_command("pyversion");
  $scope.handle_change = function() {
    return $scope.yourName = handle($scope.yourName);
  };
  $scope.file_input_change = function() {
    return py_file_input_change($scope.file_input);
  };
  $scope.index = function() {
    return $scope.num_files = run_command("index_directory -d '/Users/rabshakeh/Desktop' -i 'mydir.dict'");
  };
  return $scope.index();
};
